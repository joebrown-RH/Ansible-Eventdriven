---
- name: Get Host id
  ansible.builtin.uri:
    url: https://{{ lookup('env', 'TOWER_HOST') }}/api/v2/hosts/?name={{ inventory_hostname }}&inventory_id=5
    user: "{{ lookup('env', 'TOWER_USERNAME') }}"
    password: "{{ lookup('env', 'TOWER_PASSWORD') }}"
    force_basic_auth: true
    method: "GET"
    status_code: "200"
    validate_certs: no
  register: host_details

- name: Retrieve Job Summaries
  ansible.builtin.uri:
    url: https://controller/api/v2/hosts/{{ host_details.json.results[0].id }}/job_host_summaries/?job__job_template_id=581&created__regex={{ todays_date }}
    user: "{{ myuser }}"
    password: "{{ mypass }}"
    force_basic_auth: true
    method: "GET"
    status_code: "200"
    validate_certs: no
  register: job_details

- name: Counter value
  ansible.builtin.set_fact:
    counter: "{{ job_details | regex_findall('processed') | length }}"
